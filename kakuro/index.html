<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kakuro - Logic for Sudoku</title>
    <link rel="stylesheet" href="/src/index.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
    <header>
      <div id="site-header"></div>
    </header>

    <main class="main-wrap kakuro-container">
        <div class="game-controls">
            <div class="difficulty-selector">
                <button class="btn-difficulty" data-size="tiny">Tiny (6x6)</button>
                <button class="btn-difficulty active" data-size="small">Small (10x10)</button>
                <button class="btn-difficulty" data-size="standard">Standard (15x15)</button>
                <button class="btn-difficulty" data-size="expert">Expert (20x20)</button>
            </div>
            <div class="game-status" id="game-status">Select a size to start</div>
            <!-- Timer placeholder if needed -->
        </div>

        <div id="kakuro-grid" class="kakuro-grid">
            <!-- Grid generated by JS -->
        </div>

        <div class="numpad">
            <button class="num-btn" data-val="1">1</button>
            <button class="num-btn" data-val="2">2</button>
            <button class="num-btn" data-val="3">3</button>
            <button class="num-btn" data-val="4">4</button>
            <button class="num-btn" data-val="5">5</button>
            <button class="num-btn" data-val="6">6</button>
            <button class="num-btn" data-val="7">7</button>
            <button class="num-btn" data-val="8">8</button>
            <button class="num-btn" data-val="9">9</button>
            <button class="num-btn action-btn" data-val="clear">X</button>
        </div>
    </main>

    <div id="site-footer"></div>

    <!-- Core Scripts -->
    <script src="/js/kakuro/generator.js"></script>
    <script src="/js/kakuro/game.js"></script>
    
    <!-- Init & Partials -->
    <script>
        // Load Partials
        (function(){
            Promise.all([
                fetch('/partials/header.html?v=' + Date.now()).then(r=>r.text()),
                fetch('/partials/footer.html?v=' + Date.now()).then(r=>r.text())
            ]).then(([h,f])=>{
                var sh = document.getElementById('site-header'); if (sh) sh.innerHTML = h
                var sf = document.getElementById('site-footer'); if (sf) sf.innerHTML = f
            }).catch(e => console.error("Failed to load partials:", e));
        })();

        // Init Game
        document.addEventListener('DOMContentLoaded', () => {
            // Game instance is already created globally by game.js as window.game
            // But we can ensure it's fresh or just use it.
            // game.js ends with: window.game = new KakuroGame();
            
            if (window.game) {
                window.game.init('small');
            } else {
                console.error("KakuroGame not loaded");
            }

            // Difficulty buttons
            document.querySelectorAll('.btn-difficulty').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.btn-difficulty').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    const size = e.target.dataset.size;
                    window.game.init(size);
                });
            });

            // Numpad support
            document.querySelectorAll('.num-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const val = e.target.dataset.val;
                    if (window.game && window.game.selected) {
                        const {r, c} = window.game.selected;
                        if (val === 'clear') {
                            window.game.setInput(r, c, '');
                        } else {
                            window.game.setInput(r, c, parseInt(val));
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>