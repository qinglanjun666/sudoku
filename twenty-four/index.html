<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>24 Game — Four Numbers to 24</title>
    <meta name="description" content="24 Game: Use four numbers and + - × ÷ to make 24." />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/src/index.css" />
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5101109858499684" crossorigin="anonymous"></script>
  </head>
  <body>
    <header>
      <div id="site-header"></div>
    </header>
    <main class="main-wrap">
      <div class="container page-fit">
        <div class="breadcrumb">
          <a href="/index.html">Home</a>
          <span>›</span>
          <span class="crumb-middle">24 Game</span>
        </div>
        <section class="hero" style="display:flex;align-items:center;justify-content:center;text-align:center">
          <div>
            <h1 class="title">Four Numbers. Your Path to 24.</h1>
            <p class="subtitle secondary">A clean, fast, intuitive way to play the classic 24 game. No signup. No distractions.</p>
          </div>
        </section>
        <section class="grid-section">
          <div class="grid-bg">
            <div style="display:flex;flex-direction:column;align-items:center;gap:16px">
              <div style="font-weight:600">Where four numbers meet twenty‑four</div>
              <div style="display:flex;gap:18px;align-items:flex-start;justify-content:center">
                <div id="numbersGrid" style="display:grid;grid-template-columns:repeat(2,88px);grid-template-rows:repeat(2,72px);gap:14px"></div>
                <div id="operatorsGrid" style="display:grid;grid-template-columns:repeat(2,88px);grid-template-rows:repeat(2,72px);gap:14px">
                  <div class="btn" style="pointer-events:none;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;border-radius:16px">+</div>
                  <div class="btn" style="pointer-events:none;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;border-radius:16px">-</div>
                  <div class="btn" style="pointer-events:none;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;border-radius:16px">×</div>
                  <div class="btn" style="pointer-events:none;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;border-radius:16px">÷</div>
                </div>
              </div>
              <div style="width:100%;max-width:760px">
                <input id="exprInput" type="text" placeholder="Type: (8-2)*(3+1)  or  (8÷2)×(3+1)" style="width:100%;padding:14px 16px;border:1px solid var(--color-border);border-radius:14px;font-size:18px" />
              </div>
              <div style="width:100%;max-width:760px">
                <button id="startBtn" class="btn btn-primary" style="width:100%;background:#111;border-color:#111;color:#fff">Start Game</button>
              </div>
              <div id="actionsRow" style="display:flex;flex-wrap:wrap;gap:12px;justify-content:center">
                <button id="newSetBtn" class="btn">New Puzzle</button>
                <button id="tryAgainBtn" class="btn">Try Again</button>
                <button id="nextRoundBtn" class="btn">Next Round</button>
                <button id="resetNumbersBtn" class="btn">Reset Numbers</button>
                <button id="showStatsBtn" class="btn">Show Stats</button>
              </div>
              <div id="resultRow" class="secondary" style="margin-top:6px"></div>
            </div>
          </div>
        </section>
      </div>
    </main>
    <div id="site-footer"></div>
    <script>
      (function(){
        Promise.all([
          fetch('/partials/header.html').then(r=>r.text()),
          fetch('/partials/footer.html').then(r=>r.text())
        ]).then(([h,f])=>{
          var sh = document.getElementById('site-header'); if (sh) sh.innerHTML = h
          var sf = document.getElementById('site-footer'); if (sf) sf.innerHTML = f
        })
      })()
    </script>
    <script>
      (function(){
        const qs = s => document.querySelector(s)
        const qsa = s => Array.from(document.querySelectorAll(s))
        const EPS = 1e-6
        let nums = []
        let started = false
        let roundStartAt = null
        let lastNums = []
        function randInt(n){ return Math.floor(Math.random()*n) }
        function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }

        function canMake24(arr) {
          function dfs(list) {
            if (list.length === 1) return Math.abs(list[0] - 24) < EPS
            for (let i = 0; i < list.length; i++) {
              for (let j = 0; j < list.length; j++) {
                if (i === j) continue
                const a = list[i], b = list[j]
                const next = []
                for (let k = 0; k < list.length; k++) if (k !== i && k !== j) next.push(list[k])
                const ops = [
                  a + b,
                  a - b,
                  b - a,
                  a * b,
                ]
                if (Math.abs(b) > EPS) ops.push(a / b)
                if (Math.abs(a) > EPS) ops.push(b / a)
                for (const v of ops) {
                  next.push(v)
                  if (dfs(next)) return true
                  next.pop()
                }
              }
            }
            return false
          }
          return dfs(arr.map(Number))
        }

        function genSolvable() {
          for (let tries = 0; tries < 200; tries++) {
            const a = randInt(9)+1, b = randInt(9)+1, c = randInt(9)+1, d = randInt(9)+1
            const arr = [a,b,c,d]
            if (canMake24(arr)) return arr
          }
          return [6,6,4,2]
        }

        function renderNumbers() {
          const grid = qs('#numbersGrid')
          grid.innerHTML = ''
          nums.forEach(n => {
            const tag = document.createElement('div')
            tag.textContent = n
            tag.className = 'btn'
            tag.style.pointerEvents = 'none'
            tag.style.borderRadius = '16px'
            tag.style.fontSize = '20px'
            tag.style.fontWeight = '700'
            tag.style.display = 'flex'
            tag.style.alignItems = 'center'
            tag.style.justifyContent = 'center'
            grid.appendChild(tag)
          })
        }

        function newSet() {
          nums = genSolvable()
          lastNums = nums.slice()
          renderNumbers()
          qs('#exprInput').value = ''
          qs('#resultRow').textContent = ''
          started = false
          roundStartAt = null
          const b = qs('#startBtn'); if (b) { b.textContent = 'Start Game'; b.disabled = false; b.style.opacity = '1' }
        }

        function validExpr(expr) {
          const allowed = /^[\d\s+\-*\/()×÷]+$/
          if (!allowed.test(expr)) return { ok:false, msg:'Use only digits, + - * / and parentheses' }
          const numsInExpr = expr.match(/\d+/g) || []
          const a = numsInExpr.map(Number).sort((x,y)=>x-y)
          const b = nums.slice().sort((x,y)=>x-y)
          if (a.length !== b.length || a.some((v,i)=>v!==b[i])) return { ok:false, msg:'Use each provided number exactly once' }
          return { ok:true }
        }

        function normalizeOps(s) {
          return s.replace(/×/g, '*').replace(/÷/g, '/')
        }

        function readStats() {
          try {
            const raw = localStorage.getItem('twentyfour_stats')
            return raw ? JSON.parse(raw) : { rounds:0, wins:0, fastest:null, best_streak:0, streak:0 }
          } catch { return { rounds:0, wins:0, fastest:null, best_streak:0, streak:0 } }
        }
        function writeStats(st) {
          try { localStorage.setItem('twentyfour_stats', JSON.stringify(st)) } catch {}
        }
        function formatMs(ms) {
          const s = Math.floor(ms/1000)
          const m = Math.floor(s/60)
          const sec = s%60
          return `${m}m ${sec}s`
        }

        function checkExpr() {
          const expr = qs('#exprInput').value.trim()
          const v = validExpr(expr)
          if (!v.ok) { qs('#resultRow').textContent = v.msg; return }
          let result
          try {
            result = Function('return (' + normalizeOps(expr) + ')')()
          } catch {
            qs('#resultRow').textContent = 'Invalid expression'
            return
          }
          const st = readStats()
          st.rounds += 1
          if (Math.abs(result - 24) < EPS) {
            const elapsed = roundStartAt ? (Date.now() - roundStartAt) : null
            st.wins += 1
            st.streak = (st.streak || 0) + 1
            st.best_streak = Math.max(st.best_streak || 0, st.streak)
            if (elapsed != null && (st.fastest == null || elapsed < st.fastest)) st.fastest = elapsed
            writeStats(st)
            qs('#resultRow').textContent = 'Correct! Equals 24.' + (elapsed!=null ? (' Time: ' + formatMs(elapsed)) : '')
          } else {
            st.streak = 0
            writeStats(st)
            qs('#resultRow').textContent = 'Not 24 (' + result + '). Try again.'
          }
        }

        function startRound() {
          if (started) return
          started = true
          roundStartAt = Date.now()
          const b = qs('#startBtn'); if (b) { b.textContent = 'Running…'; b.disabled = true; b.style.opacity = '0.85' }
          qs('#exprInput').focus()
        }
        function nextRound() { newSet(); startRound() }
        function tryAgain() { qs('#exprInput').value=''; qs('#resultRow').textContent='' }
        function resetNumbers() { nums = lastNums.slice(); renderNumbers(); tryAgain() }
        function showStats() {
          const st = readStats()
          let modal = qs('#tfStatsModal')
          if (!modal) {
            modal = document.createElement('div')
            modal.id = 'tfStatsModal'
            modal.style.position = 'fixed'
            modal.style.inset = '0'
            modal.style.background = 'rgba(0,0,0,0.35)'
            modal.style.display = 'flex'
            modal.style.alignItems = 'center'
            modal.style.justifyContent = 'center'
            const card = document.createElement('div')
            card.style.background = '#fff'
            card.style.border = '1px solid var(--color-border)'
            card.style.borderRadius = '12px'
            card.style.boxShadow = '0 1px 4px rgba(0,0,0,0.06)'
            card.style.padding = '20px'
            card.style.width = '360px'
            card.style.animation = 'modalIn .25s ease'
            const h = document.createElement('div')
            h.textContent = '24 Game Stats'
            h.style.fontWeight = '600'
            h.style.marginBottom = '10px'
            const info = document.createElement('div')
            info.className = 'secondary'
            info.style.marginBottom = '12px'
            const fastest = st.fastest!=null ? formatMs(st.fastest) : '—'
            info.textContent = `Rounds: ${st.rounds} · Wins: ${st.wins} · Fastest: ${fastest} · Best Streak: ${st.best_streak||0}`
            const row = document.createElement('div')
            row.style.display='flex'; row.style.justifyContent='flex-end'; row.style.gap='8px'
            const close = document.createElement('button')
            close.className='btn'; close.textContent='Close'
            close.addEventListener('click', ()=>{ modal.remove() })
            row.appendChild(close)
            card.appendChild(h); card.appendChild(info); card.appendChild(row)
            modal.appendChild(card)
            document.body.appendChild(modal)
            modal.addEventListener('click', (e)=>{ if (e.target===modal) modal.remove() })
          }
        }

        document.addEventListener('DOMContentLoaded', function(){
          const n1 = qs('#newSetBtn'); if (n1) n1.addEventListener('click', newSet)
          const c = qs('#startBtn'); if (c) c.addEventListener('click', startRound)
          const nr = qs('#nextRoundBtn'); if (nr) nr.addEventListener('click', nextRound)
          const ta = qs('#tryAgainBtn'); if (ta) ta.addEventListener('click', tryAgain)
          const rn = qs('#resetNumbersBtn'); if (rn) rn.addEventListener('click', resetNumbers)
          const ss = qs('#showStatsBtn'); if (ss) ss.addEventListener('click', showStats)
          const input = qs('#exprInput'); if (input) input.addEventListener('keydown', function(e){ if (e.key==='Enter') checkExpr() })
          newSet()
        })
      })()
    </script>
  </body>
</html>
