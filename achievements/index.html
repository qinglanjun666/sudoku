<!doctype html>
<html lang="en">
  <head>
    <script>
      (function(){
        var isLocal = location.hostname === 'localhost' || location.hostname === '127.0.0.1'
        if (isLocal) return
        var ad = document.createElement('script')
        ad.async = true
        ad.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5101109858499684"
        ad.crossOrigin = "anonymous"
        document.head.appendChild(ad)
      })()
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Game Achievements - Logic for Sudoku</title>
    <meta name="description" content="Track your progress and achievements across Sudoku, 24 Game, Calcudoku, and Kakuro." />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/src/index.css?v=2" />
    <style>
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 32px;
            margin-bottom: 48px;
        }
        .achievement-card {
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .game-title {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 16px;
            border-bottom: 2px solid #f3f4f6;
            padding-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .trophy-row {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .trophy-row:last-child {
            border-bottom: none;
        }
        .trophy-icon {
            width: 48px;
            height: 48px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f3f4f6;
            border-radius: 50%;
            color: #9ca3af;
            transition: all 0.3s ease;
        }
        .trophy-icon.unlocked {
            background: #fffbeb;
            color: #f59e0b;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.2);
        }
        .trophy-info {
            flex: 1;
        }
        .trophy-name {
            font-weight: 600;
            color: #374151;
            font-size: 15px;
            margin-bottom: 2px;
        }
        .trophy-desc {
            font-size: 13px;
            color: #6b7280;
        }
        .trophy-status {
            font-size: 12px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 999px;
            background: #f3f4f6;
            color: #6b7280;
        }
        .trophy-status.unlocked {
            background: #d1fae5;
            color: #059669;
        }
        
        /* Heatmap Styles */
        .heatmap-container {
            margin-top: 24px;
            margin-bottom: 32px;
            padding: 24px;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .heatmap-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .heatmap-title {
            font-size: 16px;
            font-weight: 600;
            color: #111;
        }
        .heatmap-count {
            font-size: 14px;
            color: #6b7280;
        }
        .heatmap-scroll {
            overflow-x: auto;
            padding-bottom: 8px;
        }
        .heatmap-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 4px;
        }
        .heatmap-days {
            display: grid;
            grid-template-rows: repeat(7, 12px);
            gap: 3px;
            margin-top: 20px; /* Align with grid below months */
        }
        .heatmap-day {
            font-size: 10px;
            line-height: 12px;
            color: #6b7280;
            text-align: right;
            height: 12px;
            padding-right: 4px;
        }
        .heatmap-content {
            display: flex;
            flex-direction: column;
        }
        .heatmap-months {
            position: relative;
            height: 20px;
            margin-bottom: 0;
        }
        .heatmap-month {
            position: absolute;
            font-size: 10px;
            color: #6b7280;
            top: 0;
            line-height: 12px;
        }
        .heatmap-grid {
            display: grid;
            grid-template-rows: repeat(7, 12px);
            grid-auto-flow: column;
            gap: 3px;
            width: max-content;
        }
        .heatmap-cell {
            width: 12px;
            height: 12px;
            background: #ebedf0;
            border-radius: 2px;
            position: relative;
        }
        .heatmap-cell.active {
            background: #40c463;
        }
        .heatmap-cell.active-high {
            background: #166534; /* Dark Green */
        }
        .heatmap-cell:hover::after {
            content: attr(data-date);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #000;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            pointer-events: none;
            z-index: 10;
            margin-bottom: 4px;
        }
        .heatmap-legend {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 4px;
            margin-top: 8px;
            font-size: 12px;
            color: #6b7280;
        }
        .heatmap-legend-cell {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        .heatmap-inner {
            display: flex;
            flex-direction: column;
            width: max-content;
        }
        .year-select {
            padding: 2px 8px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            color: #374151;
            background-color: #fff;
            cursor: pointer;
        }
        .year-select:focus {
            outline: none;
            border-color: #40c463;
        }
        .heatmap-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }
    </style>
  </head>
  <body>
    <header>
      <div id="site-header"></div>
    </header>
    <main class="main-wrap">
      <div class="container page-fit">
        <nav class="breadcrumb">
            <a href="/index.html">Home</a>
            <span>></span>
            <span class="crumb-middle">Achievements</span>
        </nav>
        
        <h1 style="font-size: 28px; font-weight: 800; margin-top: 24px; color: #111;">Your Trophy Room</h1>
        <p style="color: #666; margin-top: 8px;">Track your mastery across all our puzzle games. Unlock trophies by winning games!</p>

        <!-- Daily Challenge Heatmap -->
        <div class="heatmap-container">
            <div class="heatmap-scroll">
                <div class="heatmap-inner">
                    <div class="heatmap-header">
                        <div class="heatmap-title">
                            Daily Challenge Activity
                            <a href="/sudoku/daily/?view=archive" style="margin-left: 12px; font-size: 14px; text-decoration: none; color: #4b5563; font-weight: 600; border-bottom: 1px dashed #9ca3af;">Enter Daily Challenge Calendar</a>
                        </div>
                        <div class="heatmap-controls">
                            <div class="heatmap-count" id="heatmapCount">Loading...</div>
                            <select id="yearSelect" class="year-select" onchange="renderHeatmap(this.value)">
                                <option value="2025" selected>2025</option>
                                <option value="2026">2026</option>
                            </select>
                        </div>
                    </div>
                    <div class="heatmap-wrapper">
                        <div class="heatmap-days">
                            <div class="heatmap-day"></div> <!-- Sun -->
                            <div class="heatmap-day">Mon</div>
                            <div class="heatmap-day">Tue</div>
                            <div class="heatmap-day">Wed</div>
                            <div class="heatmap-day">Thu</div>
                            <div class="heatmap-day">Fri</div>
                            <div class="heatmap-day"></div> <!-- Sat -->
                        </div>
                        <div class="heatmap-content">
                            <div class="heatmap-months" id="heatmapMonths"></div>
                            <div class="heatmap-grid" id="heatmapGrid"></div>
                        </div>
                    </div>
                    <div class="heatmap-legend">
                        <span>Incomplete</span>
                        <div class="heatmap-legend-cell" style="background: #ebedf0"></div>
                        <div class="heatmap-legend-cell" style="background: #40c463"></div>
                        <span>Completed</span>
                        <div class="heatmap-legend-cell" style="background: #166534"></div>
                        <span>More</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="achievements-grid" id="achievementsGrid">
            <!-- Content loaded via JS -->
        </div>

      </div>
    </main>
    <div id="site-footer"></div>
    <script src="/src/layout.js"></script>
    <script>
    ;(function(){
        // Icons
        const icons = {
            trophy: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>',
            sudoku: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v18"/><path d="M15 3v18"/></svg>',
            calc: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>',
            kakuro: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3L2 12l10 9 10-9-10-9z"/></svg>',
            futoshiki: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M14 8l-4 4 4 4"/></svg>',
            game24: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 8v8"/><path d="M8 12h8"/></svg>'
        }

        function renderHeatmap(year = 2025) {
            year = parseInt(year);
            const container = document.getElementById('heatmapGrid');
            const monthsContainer = document.getElementById('heatmapMonths');
            const countEl = document.getElementById('heatmapCount');
            
            if (!container || !monthsContainer) return;

            if (year === 2026) {
                container.innerHTML = '<div style="padding: 20px; font-size: 14px; color: #666;">Coming next year</div>';
                monthsContainer.innerHTML = '';
                countEl.textContent = `0 contributions in the 2026`;
                container.style.display = 'block';
                container.style.gridTemplateRows = 'none';
                container.style.width = '100%';
                return;
            } else {
                container.style.display = 'grid';
                container.style.gridTemplateRows = 'repeat(7, 12px)';
                container.style.width = 'max-content';
            }
            
            const history = JSON.parse(localStorage.getItem('sudoku_daily_history') || '[]');
            const historySet = new Set(history);
            const dailyCounts = JSON.parse(localStorage.getItem('sudoku_daily_counts') || '{}');
            
            // Logic for 2025: Show full year 2025 or "Last Year" logic?
            // User asked for "1 contributions in the 2025" and logic seems to be tied to 2025.
            // Current implementation was "last 365 days". 
            // I will switch it to fixed year 2025 for this view as per request context, or keep rolling if preferred?
            // "Daily Challenge Activity in 2025" implies fixed year.
            // Let's implement fixed year 2025 (Jan 1 to Dec 31)
            
            const startDate = new Date(year, 0, 1); // Jan 1
            // Align to previous Sunday if needed for grid alignment?
            // Usually GitHub contributions start from the exact date or align week. 
            // If I stick to the previous code's "align to Sunday" logic, it's safer for the grid layout.
            
            const gridStartDate = new Date(startDate);
            while (gridStartDate.getDay() !== 0) {
                gridStartDate.setDate(gridStartDate.getDate() - 1);
            }
            
            let html = '';
            let monthsHtml = '';
            let currentDate = new Date(gridStartDate);
            
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            let lastMonth = -1;

            // 53 weeks covers a full year usually
            let totalContributions = 0;

            for (let w = 0; w < 53; w++) {
                // Check month of the first day of the week (Sunday)
                // Only show month label if the sunday is within the target year or close to it
                const currentMonth = currentDate.getMonth();
                const currentYear = currentDate.getFullYear();
                
                // Simple logic: Label based on week start
                if (currentMonth !== lastMonth && currentYear === year) {
                    monthsHtml += `<div class="heatmap-month" style="left: ${w * 15}px">${monthNames[currentMonth]}</div>`;
                    lastMonth = currentMonth;
                }

                for (let d = 0; d < 7; d++) {
                    const dateStr = currentDate.toISOString().split('T')[0];
                    const count = dailyCounts[dateStr] || 0;
                    const isActive = historySet.has(dateStr); 
                    
                    // Only count if within the selected year
                    if (currentDate.getFullYear() === year) {
                        if (count > 0 || isActive) totalContributions += (count || 1);
                    }

                    let colorClass = '';
                    // Only show color if it matches the year (optional, but standard heatmap shows neighbors too)
                    // Let's show all for continuity, but maybe dim non-year days? 
                    // GitHub shows gray for non-year days usually if out of range, but here we just show what we have.
                    
                    if (count > 3) colorClass = 'active-high';
                    else if (count > 0 || isActive) colorClass = 'active';
                    
                    html += `<div class="heatmap-cell ${colorClass}" data-date="${dateStr}"></div>`;
                    
                    currentDate.setDate(currentDate.getDate() + 1);
                }
            }
            
            container.innerHTML = html;
            monthsContainer.innerHTML = monthsHtml;
            countEl.textContent = `${totalContributions} contributions in the ${year}`;
        }

        function renderAchievements() {
            const grid = document.getElementById('achievementsGrid');
            
            // Read Stats
            const sStats = JSON.parse(localStorage.getItem('sudoku_stats') || '{}').completed || {};
            const kStats = JSON.parse(localStorage.getItem('kakuro_stats') || '{}').completed || {};
            const cStats = JSON.parse(localStorage.getItem('calcudoku_stats') || '{}').completed || {};
            const tfStats = JSON.parse(localStorage.getItem('24game_stats') || '{}');
            const tfWins = tfStats.completed || 0;
            const fStats = JSON.parse(localStorage.getItem('futoshiki_stats') || '{}').completed || {};

            // Define Games and Trophies
            const games = [
                {
                    id: 'sudoku',
                    name: 'Sudoku',
                    link: '/sudoku/',
                    icon: icons.sudoku,
                    trophies: [
                        { name: 'Beginner Glory', desc: 'Win 5 Easy games', req: 5, current: sStats.easy || 0 },
                        { name: 'Intermediate Glory', desc: 'Win 5 Medium games', req: 5, current: sStats.medium || 0 },
                        { name: 'Advanced Glory', desc: 'Win 5 Hard games', req: 5, current: sStats.hard || 0 },
                        { name: 'Industry Expert', desc: 'Win 20 Hard games', req: 20, current: sStats.hard || 0 }
                    ]
                },
                {
                    id: 'game24',
                    name: '24 Game',
                    link: '/twenty-four/',
                    icon: icons.game24,
                    trophies: [
                        { name: 'Beginner Glory', desc: 'Win 5 games', req: 5, current: tfWins },
                        { name: 'Intermediate Glory', desc: 'Win 20 games', req: 20, current: tfWins },
                        { name: 'Advanced Glory', desc: 'Win 50 games', req: 50, current: tfWins },
                        { name: 'Industry Expert', desc: 'Win 100 games', req: 100, current: tfWins }
                    ]
                },
                {
                    id: 'kakuro',
                    name: 'Kakuro',
                    link: '/kakuro/',
                    icon: icons.kakuro,
                    trophies: [
                        { name: 'Beginner Glory', desc: 'Win 5 Beginner games', req: 5, current: kStats.beginner || 0 },
                        { name: 'Intermediate Glory', desc: 'Win 5 Easy games', req: 5, current: kStats.easy || 0 },
                        { name: 'Advanced Glory', desc: 'Win 5 Medium games', req: 5, current: kStats.medium || 0 },
                        { name: 'Industry Expert', desc: 'Win 5 Hard games', req: 5, current: kStats.hard || 0 }
                    ]
                },
                {
                    id: 'calcudoku',
                    name: 'Calcudoku',
                    link: '/calcudoku/',
                    icon: icons.calc,
                    trophies: [
                        { name: 'Beginner Glory', desc: 'Win 5 Standard (4x4) games', req: 5, current: cStats['4'] || 0 },
                        { name: 'Intermediate Glory', desc: 'Win 5 Interm. (5x5) games', req: 5, current: cStats['5'] || 0 },
                        { name: 'Advanced Glory', desc: 'Win 5 Chall. (6x6) games', req: 5, current: cStats['6'] || 0 },
                        { name: 'Industry Expert', desc: 'Win 5 Hard (7x7+) games', req: 5, current: (cStats['7']||0) + (cStats['8']||0) + (cStats['9']||0) }
                    ]
                },
                {
                    id: 'futoshiki',
                    name: 'Futoshiki',
                    link: '/futoshiki/',
                    icon: icons.futoshiki,
                    trophies: [
                        { name: 'Beginner Glory', desc: 'Win 5 4x4 Easy games', req: 5, current: fStats['4-Easy'] || 0 },
                        { name: 'Intermediate Glory', desc: 'Win 5 5x5 Easy games', req: 5, current: fStats['5-Easy'] || 0 },
                        { name: 'Advanced Glory', desc: 'Win 5 6x6 Easy games', req: 5, current: fStats['6-Easy'] || 0 },
                        { name: 'Industry Expert', desc: 'Win 10 Hard games', req: 10, current: (fStats['4-Hard']||0) + (fStats['5-Hard']||0) + (fStats['6-Hard']||0) }
                    ]
                }
            ];

            let html = '';
            games.forEach(game => {
                html += `<div class="achievement-card">
                    <div class="game-title">
                        ${game.icon} 
                        <a href="${game.link}" style="color: inherit; text-decoration: none;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">
                            ${game.name}
                        </a>
                    </div>`;
                
                game.trophies.forEach(t => {
                    const isUnlocked = t.current >= t.req;
                    html += `<div class="trophy-row">
                        <div class="trophy-icon ${isUnlocked ? 'unlocked' : ''}">
                            ${icons.trophy}
                        </div>
                        <div class="trophy-info">
                            <div class="trophy-name">${t.name}</div>
                            <div class="trophy-desc">${t.desc}</div>
                        </div>
                        <div class="trophy-status ${isUnlocked ? 'unlocked' : ''}">
                            ${isUnlocked ? 'Unlocked' : `${t.current}/${t.req}`}
                        </div>
                    </div>`;
                });

                html += `</div>`;
            });

            grid.innerHTML = html;
        }

        renderHeatmap();
        renderAchievements();
      })()
    </script>
    <script src="/src/records.js"></script>
  </body>
</html>